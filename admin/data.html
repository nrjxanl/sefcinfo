<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Page-Enter" content="revealtrans(duration=1, transition=23)">
    <title>SEFCiNFO Data Manager</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="icon" type="image/x-icon" href="../files/favicon.png">
    
    <style>
/* =========================================
   Paperlogy & KLeague 디자인 가이드라인 반영
   순위표 입력창 자동 높이 조절 포함 최종 CSS
   ========================================= */

/* 1. 폰트 설정 (경로: ../files/) */
@font-face {font-family: "Paperlogy"; font-weight: 300; src: url(../files/Paperlogy-3Light.ttf);}
@font-face {font-family: "Paperlogy"; font-weight: 600; src: url(../files/Paperlogy-6SemiBold.ttf);}
@font-face {font-family: "Paperlogy"; font-weight: 900; src: url(../files/Paperlogy-9Black.ttf);}
@font-face {font-family: "KLeagueBasic"; font-weight: 900; src: url(../files/KLeagueBasic-Medium.ttf);}

/* 2. 기본 초기화 */
* {
    color: #05090a; 
    margin: 0; padding: 0; 
    font-family: "Paperlogy"; 
    font-weight: 600; 
    word-break: keep-all; 
    -webkit-tap-highlight-color: transparent; 
    user-select: none;
    box-sizing: border-box;
}

/* 스크롤바 숨기기 */
*::-webkit-scrollbar { display: none; }

html, body { 
    width: 100%; 
    overflow-x: hidden; 
    background: #00006003; 
}

body { 
    padding: 40px 15px; 
    display: flex; 
    flex-direction: column; 
    align-items: center;
}

h1 { font-family: "Paperlogy"; font-weight: 900; font-size: 26px; color: #000060; margin-bottom: 5px; }
h2 { font-family: "Paperlogy"; font-weight: 900; font-size: 20px; margin-bottom: 25px; color: #333; }

/* 3. 로그인 및 상단 UI */
#login-container {
    max-width: 400px; width: 100%; margin-top: 100px; background: white; padding: 40px;
    border-radius: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); text-align: center;
}
#btnLogin {
    width: 100%; padding: 18px; background: #000060; color: white; border: none;
    border-radius: 30px; cursor: pointer; font-weight: 900; font-size: 16px; margin-top: 25px;
    transition: transform 0.2s;
}
#btnLogin:active { transform: scale(0.96); }

#admin-panel { display: none; width: 100%; max-width: 800px; }
#btnLogout {
    background: #faf6f5; color: #666; border: 1px solid #eee; padding: 8px 18px;
    border-radius: 20px; cursor: pointer; font-size: 13px; font-weight: 600;
}

.team-selector { 
    background: #fff; padding: 20px; border-radius: 25px; margin-bottom: 20px; 
    display: flex; justify-content: center; gap: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.02); 
}
.team-selector label { font-weight: 900; font-size: 16px; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; }
.team-selector input[type="radio"] { transform: scale(1.4); accent-color: #000060; }

.menu-bar { margin-bottom: 25px; display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; width: 100%; }
.menu-bar button {
    padding: 12px 24px; border: none; cursor: pointer; white-space: nowrap;
    background: #fff; color: #aaa; font-weight: 900; border-radius: 30px;
    font-size: 14px; transition: all 0.3s; box-shadow: 0 2px 8px rgba(0,0,0,0.03);
}
.menu-bar button.active { background: #000060; color: #fff; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,96,0.1); }

/* 4. 카드 및 입력창 공통 */
.form-container { 
    display: none; background: #fff; padding: 35px; border-radius: 30px; 
    box-shadow: 0 10px 50px rgba(0,0,0,0.04); border: 1px solid rgba(0,0,60,0.03); 
    width: 100%; margin-bottom: 50px;
}
.form-container.active { display: block; animation: fadeIn 0.4s ease; }

.input-group { margin-bottom: 22px; position: relative; text-align: left; }
.input-group label { display: block; font-weight: 900; margin-bottom: 10px; font-size: 13px; color: #000060; padding-left: 5px; }
.input-group input, .input-group select, .input-group textarea {
    width: 100%; padding: 15px 20px; border: 1px solid #f2f2f5; border-radius: 18px; 
    font-size: 15px; background: #f9f9fb; font-weight: 600; outline: none; transition: all 0.2s;
}
.input-group input:focus, .input-group textarea:focus { border-color: #000060; background: #fff; box-shadow: 0 0 0 4px rgba(0,0,96,0.03); }

/* [중요] 순위표 입력창 유동적 높이 설정 */
#s_data {
    height: auto;
    min-height: 200px;
    field-sizing: content; /* 내용에 따라 자동으로 늘어남 */
    resize: vertical; /* 수동 조절도 가능하게 유지 */
    line-height: 1.6;
    font-family: monospace;
}

.btn-inline {
    position: absolute; right: 10px; top: 0;
    background: #000060; color: white; border: none; padding: 6px 16px;
    font-size: 11px; cursor: pointer; border-radius: 15px; font-weight: 900;
}

.row { display: flex; gap: 15px; width: 100%; }
.row .input-group { flex: 1; min-width: 0; }

/* 5. 미리보기 요소 (엠블럼 & 색상) */
.code-wrapper { position: relative; display: flex; align-items: center; gap: 12px; width: 100%; }
.team-emblem-preview {
    width: 46px; height: 46px; object-fit: contain;
    background: #fff; border-radius: 15px; padding: 5px; border: 1px solid #eee; display: none; flex-shrink: 0;
}
.hex-wrapper { display: flex; align-items: center; gap: 12px; width: 100%; position: relative; }
.hex-wrapper .prefix { position: absolute; left: 18px; color: #000060; font-weight: 900; z-index: 1; }
.hex-wrapper input { padding-left: 35px !important; text-transform: uppercase; font-family: monospace; }
.color-preview {
    width: 46px; height: 46px; border-radius: 15px; border: 1px solid #f0f0f4;
    background-color: #fff; flex-shrink: 0; box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
}

/* 6. 선수 명단 그리드 */
.pos-section { margin-bottom: 35px; }
.pos-title { 
    font-family: "KLeagueBasic"; font-weight: 900; color: #000060; 
    margin-bottom: 18px; font-size: 18px; border-left: 6px solid #000060; padding-left: 14px;
}
.player-grid-row { 
    display: grid; 
    grid-template-columns: 40px 1.5fr 1fr 0.8fr; 
    gap: 10px; 
    margin-bottom: 10px; 
    align-items: center; 
}
.row-index {
    text-align: center; font-size: 11px; font-weight: 900; color: #bbb;
    background: #f0f0f4; border-radius: 12px; height: 45px; line-height: 45px;
}
.player-grid-row input { 
    padding: 12px; font-size: 14px; border: 1px solid #f0f0f4; border-radius: 15px; 
    height: 45px; background: #f9f9fb; text-align: center;
}
.player-grid-row input:nth-child(2) { text-align: left; padding-left: 15px; font-weight: 900; }

/* 7. 등번호 페이지 그리드 (3열) */
.num-item { display: grid !important; grid-template-columns: 2.2fr 1fr 0.8fr !important; gap: 10px; width: 100%; margin-bottom: 10px; }
#num .player-grid-row[style*="font-weight:bold"] {
    display: grid !important; grid-template-columns: 2.2fr 1fr 0.8fr !important;
    gap: 10px; background: #f0f0f4 !important; color: #000060 !important;
    padding: 12px; border-radius: 18px; margin-bottom: 15px;
}

/* 8. 세부 지표 디자인 */
.stat-header {
    display: grid; grid-template-columns: 1.2fr 1fr 1fr; 
    gap: 10px; background: #f0f0f4; padding: 12px; border-radius: 18px; 
    margin-bottom: 12px; font-weight: 900; font-size: 13px; color: #000060; text-align: center;
}
.stat-row { display: grid; grid-template-columns: 1.2fr 1fr 1fr; gap: 10px; margin-bottom: 10px; }
.stat-label { background: #f0f0f4; border-radius: 12px; height: 45px; line-height: 45px; text-align: center; font-size: 13px; font-weight: 900; color: #000060; }
.stat-input { padding: 10px; font-size: 14px; border: 1px solid #f0f0f4; border-radius: 15px; height: 45px; text-align: center; font-weight: 900; background: #f9f9fb; }

/* 9. 순위표 미리보기 (스크롤 없는 고정 너비) */
#standings-preview { 
    margin-top: 25px; 
    padding: 10px; 
    background: #f9f9fb; 
    border-radius: 20px; 
    border: 1px solid #f0f0f4; 
    width: 100%;
    overflow: hidden;
}
#preview-table { 
    width: 100%; 
    border-collapse: collapse; 
    font-size: 13px;
    table-layout: fixed;
}
#preview-table th { 
    background: #f0f0f4; 
    color: #000060; 
    font-weight: 900; 
    padding: 12px 2px; 
    border-bottom: 2px solid #00006015;
}
#preview-table td { 
    padding: 10px 2px; 
    color: #333; 
    font-weight: 600; 
    text-align: center; 
    border-bottom: 1px solid #f0f0f4;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
#preview-table th:nth-child(1), #preview-table td:nth-child(1) { width: 8%; }
#preview-table th:nth-child(2), #preview-table td:nth-child(2) { width: 28%; text-align: left; padding-left: 10px; font-weight: 900; color: #000060; }
#preview-table th:nth-child(3), #preview-table td:nth-child(3) { width: 10%; }
#preview-table th:nth-child(n+4), #preview-table td:nth-child(n+4) { width: 9%; }

/* 10. 하단 버튼 */
.sub-title { font-size: 22px; font-weight: 900; margin: 45px 0 25px; color: #000060; text-align: left; }
.btn-submit {
    background: #000060; color: white; padding: 22px; width: 100%; border: none;
    font-size: 18px; font-weight: 900; border-radius: 25px; cursor: pointer; margin-top: 40px;
    box-shadow: 0 10px 25px rgba(0,0,96,0.15); transition: all 0.2s;
}
.btn-submit:active { transform: scale(0.97); }
.btn-delete {
    background: #fff; color: #ff4d4d; padding: 15px; width: 100%; border: 1.5px solid #ff4d4d;
    font-size: 14px; font-weight: 900; border-radius: 25px; cursor: pointer; margin-top: 15px;
}

/* 11. 모바일 반응형 (768px 이하) */
@media screen and (max-width: 768px) {
    body { padding: 25px 15px; }
    h1 { font-size: 22px; }
    .form-container { padding: 25px 18px; border-radius: 25px; }
    .row { flex-direction: column; gap: 0; }
    
    .player-grid-row { gap: 6px; grid-template-columns: 35px 1.8fr 1fr 0.8fr; }
    .player-grid-row input { font-size: 12px; padding: 8px; height: 42px; }
    
    .num-item, #num .player-grid-row[style*="font-weight:bold"] { grid-template-columns: 1.8fr 1fr 0.7fr !important; gap: 6px; }
    
    .stat-row, .stat-header { grid-template-columns: 1.1fr 1fr 1fr; gap: 6px; }
    .stat-label, .stat-input { font-size: 11px; height: 42px; line-height: 42px; }
    
    #preview-table { font-size: 9px; }
    #preview-table th, #preview-table td { padding: 8px 1px; }
    #preview-table td:nth-child(2) { padding-left: 5px; }

    .btn-inline { font-size: 10px; padding: 5px 12px; right: 5px; }
    .input-group label { font-size: 11px; }
    .sub-title { font-size: 19px; margin: 35px 0 20px; }
}
    </style>
</head>

<body oncontextmenu="return false">

    <div id="login-container">
        <h2>관리자 접속</h2>
        <p style="color:#666; font-size:14px;">데이터 관리를 위해 로그인이 필요합니다.</p>
        <button id="btnLogin">G Google 계정으로 로그인</button>
    </div>

    <div id="admin-panel">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h1>SEFCiNFO Data Manager</h1>
            <button id="btnLogout">로그아웃</button>
        </div>

        <div class="team-selector">
            <label><input type="radio" name="teamType" value="A" checked> A팀</label>
            <label><input type="radio" name="teamType" value="U18"> U-18</label>
            <label><input type="radio" name="teamType" value="U15"> U-15</label>
        </div>

        <div class="menu-bar">
            <button onclick="showForm('match')" class="active">경기 기록</button>
            <button onclick="showForm('player')">선수 정보</button>
            <button onclick="showForm('h2h')">상대 전적</button>
            <button onclick="showForm('num')">등번호</button>
            <button onclick="showForm('standings')">순위</button>
        </div>

        <div id="match" class="form-container active">
            <h2>경기 데이터 추가/수정</h2>
            <div class="row">
                <div class="input-group">
                    <label>날짜 (YYYYMMDD)</label>
                    <input type="tel" id="m_date" placeholder="예: 20250301">
                    <button class="btn-inline" id="btnSearchMatch">검색 / 불러오기</button>
                    <p style="font-size:12px; color:#666; margin-top:5px;">* 팀 선택에 따라 끝자리(0, 8, 5)가 자동 생성됩니다.</p>
                </div>
                <div class="input-group"><label>라운드</label><input type="text" id="m_round"></div>
            </div>
            <div class="row">
                <div class="input-group"><label>대회명</label><input type="text" id="m_compName"></div>
                <div class="input-group">
                    <label>대회코드</label>
                    <div class="code-wrapper">
                        <input type="text" id="m_compCode">
                        <img id="preview_comp" class="team-emblem-preview" alt="Comp">
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="input-group"><label>경기장</label><input type="text" id="m_stadium"></div>
                <div class="input-group">
                    <label>시각</label>
                    <div style="display:flex; gap:5px; align-items:center;">
                        <input type="tel" id="m_hour" placeholder="시" style="text-align:center;">
                        <span>:</span>
                        <input type="tel" id="m_min" placeholder="분" style="text-align:center;">
                    </div>
                </div>
            </div>
            <div class="input-group">
                <label>하이라이트 (URL)</label>
                <input type="text" id="m_hl" placeholder="youtu.be 제외">
            </div>

            <div class="sub-title">팀 & 스코어</div>
            <div class="row">
                <div class="input-group"><label>홈팀명</label><input type="text" id="m_homeName"></div>
                <div class="input-group">
                    <label>홈팀코드</label>
                    <div class="code-wrapper">
                        <input type="text" id="m_homeCode">
                        <img id="preview_home" class="team-emblem-preview" alt="Home">
                    </div>
                </div>
                <div class="input-group"><label>홈점수</label><input type="tel" id="m_homeScore"></div>
            </div>
            <div class="input-group"><label>홈 득점자 (HTML 가능)</label><input type="text" id="m_homeScorer"></div>

            <div class="row">
                <div class="input-group"><label>원정팀명</label><input type="text" id="m_awayName"></div>
                <div class="input-group">
                    <label>원정팀코드</label>
                    <div class="code-wrapper">
                        <input type="text" id="m_awayCode">
                        <img id="preview_away" class="team-emblem-preview" alt="Away">
                    </div>
                </div>
                <div class="input-group"><label>원정점수</label><input type="tel" id="m_awayScore"></div>
            </div>
            <div class="input-group"><label>원정 득점자 (HTML 가능)</label><input type="text" id="m_awayScorer"></div>

            <div class="sub-title">선수 명단 (이름 입력 시 ID 자동)</div>
            <p class="helper-text">* 입력하면 자동으로 다음 칸이 생성됩니다.</p>
            <div id="match-player-inputs"></div>

            <div class="sub-title">경기 세부 지표</div>
            <div class="stat-grid" id="match-stats-inputs">
                <div class="stat-header">
                    <div style="flex:1.2; text-align:center;">항목</div>
                    <div style="flex:1; text-align:center;">홈</div>
                    <div style="flex:1; text-align:center;">원정</div>
                </div>
                </div>

            <button class="btn-submit" id="btnSaveMatch">Firebase에 저장 (덮어쓰기)</button>
            <button class="btn-delete" id="btnDeleteMatch">현재 날짜의 경기 데이터 삭제</button>
        </div>

        <div id="player" class="form-container">
            <h2>선수 상세 정보 추가/수정</h2>
            <div class="input-group">
                <label>선수 ID</label>
                <input type="tel" id="p_id">
                <button class="btn-inline" id="btnSearchPlayer">ID로 데이터 불러오기</button>
            </div>
            <div class="row">
                <div class="input-group">
                    <label>이름</label>
                    <input type="text" id="p_name">
                    <button class="btn-inline" id="btnCheckName" style="top:25px;">중복확인 (동명이인 포함)</button>
                    <button class="btn-inline" id="btnGenerateId" style="top:60px; background:#444;">ID 난수 생성</button>
                </div>
                <div class="input-group"><label>생년월일</label><input type="tel" id="p_bd"></div>
            </div>
            <div class="row">
                <div class="input-group"><label>국적</label><input type="text" id="p_natl"></div>
                <div class="input-group"><label>포지션</label><input type="text" id="p_pos"></div>
                <div class="input-group"><label>키 (cm)</label><input type="tel" id="p_height"></div>
            </div>
            <div class="row">
                <div class="input-group"><label>SNS ID</label><input type="text" id="p_sns"></div>
                <div class="input-group"><label>현재 소속 여부 (O/X)</label><input type="text" id="p_sefc"></div>
            </div>
            <button class="btn-submit" id="btnSavePlayer">Firebase에 저장</button>
            <button class="btn-delete" id="btnDeletePlayer">현재 ID의 선수 데이터 삭제</button>
        </div>

        <div id="h2h" class="form-container">
            <h2>상대 전적 추가/수정</h2>
            <div class="input-group">
                <label>상대팀 코드 (Key)</label>
                <div class="code-wrapper">
                    <input type="text" id="h_code">
                    <img id="preview_h2h" class="team-emblem-preview" alt="H2H">
                    <button class="btn-inline" id="btnSearchH2H" style="top:-30px;">코드 검색 / 불러오기</button>
                </div>
            </div>
            
            <div class="row">
                <div class="input-group">
                    <label>배경색 (Hex)</label>
                    <div class="hex-wrapper">
                        <span class="prefix">#</span>
                        <input type="text" id="h_bg" maxlength="6" placeholder="FFFFFF">
                        <div class="color-preview" id="preview_bg"></div>
                    </div>
                </div>
                <div class="input-group">
                    <label>글자색 (Hex)</label>
                    <div class="hex-wrapper">
                        <span class="prefix">#</span>
                        <input type="text" id="h_text" maxlength="6" placeholder="000000">
                        <div class="color-preview" id="preview_text"></div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="input-group"><label>승</label><input type="tel" id="h_w"></div>
                <div class="input-group"><label>무</label><input type="tel" id="h_d"></div>
                <div class="input-group"><label>패</label><input type="tel" id="h_l"></div>
            </div>
            <div class="row">
                <div class="input-group"><label>득점</label><input type="tel" id="h_gf"></div>
                <div class="input-group"><label>실점</label><input type="tel" id="h_ga"></div>
            </div>
            <button class="btn-submit" id="btnSaveH2H">Firebase에 저장</button>
        </div>

        <div id="num" class="form-container">
            <h2>등번호 데이터 관리</h2>
            <div class="row">
                <div class="input-group">
                    <label>연도 선택</label>
                    <select id="n_yearSelect"></select>
                </div>
            </div>
            
            <div class="sub-title">선수 목록 (이름 입력 시 ID 자동)</div>
            <div class="player-grid-row" style="font-weight:bold; background:#e0e0e0; padding:8px; border-radius:4px;">
                <div style="flex:1.2;">이름</div>
                <div style="flex:0.9; text-align:center;">ID</div>
                <div style="flex:0.5; text-align:center;">번호</div>
            </div>
            <div id="num-list-container"></div>
            <button class="btn-submit" id="btnSaveNum">전체 리스트 저장 (덮어쓰기)</button>
        </div>

        <div id="standings" class="form-container">
            <h2>순위표 데이터 (자동 계산)</h2>
            <div class="row">
                <div class="input-group">
                    <label>연도 (Key)</label>
                    <select id="s_yearSelect"></select>
                </div>
                <div class="input-group">
                    <label>리그 선택</label>
                    <select id="s_leagueType">
                        <option value="A">A팀</option>
                        <option value="U18F">U-18 (전반기)</option>
                        <option value="U18S">U-18 (후반기)</option>
                        <option value="U15">U-15</option>
                    </select>
                </div>
            </div>

            <div class="input-group">
                <label>데이터 입력 (공백 2개로 구분)</label>
                <div class="standings-header">
                    <span style="flex:2.5;">팀명</span>
                    <span style="flex:1;">승</span>
                    <span style="flex:1;">무</span>
                    <span style="flex:1;">패</span>
                    <span style="flex:1;">득</span>
                    <span style="flex:1;">실</span>
                </div>
                <textarea id="s_data" placeholder="예: 서울 이랜드  20  10  6  60  30"></textarea>
                
                <div id="standings-preview">
                    <div style="color:#888; font-size:13px; text-align:center;">데이터를 입력하면 미리보기가 표시됩니다.</div>
                </div>
            </div>
            <button class="btn-submit" id="btnSaveStanding">전체 순위 저장 (덮어쓰기)</button>
        </div>
    </div>
    
    <script type="module">
        import { db, auth } from '../firebase.js';
        import { ref, set, update, get, child, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // ===============================================
        // [설정] 여기에 허용할 관리자 이메일을 정확히 입력하세요!
        // ===============================================
        const ADMIN_EMAIL = "gwcom112@gmail.com"; 

        const provider = new GoogleAuthProvider();
        const loginContainer = document.getElementById('login-container');
        const adminPanel = document.getElementById('admin-panel');

        // 1. 로그인 버튼
        document.getElementById('btnLogin').addEventListener('click', () => {
            signInWithPopup(auth, provider)
                .then((result) => {
                    console.log("로그인 성공:", result.user.email);
                })
                .catch((error) => {
                    alert("로그인 실패: " + error.message);
                });
        });

        // 2. 로그아웃 버튼
        document.getElementById('btnLogout').addEventListener('click', () => {
            if(confirm("로그아웃 하시겠습니까?")) {
                signOut(auth).then(() => {
                    alert("로그아웃 되었습니다.");
                    location.reload();
                });
            }
        });

        // 3. 로그인 상태 감지
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // 이메일 확인
                if (user.email === ADMIN_EMAIL) {
                    loginContainer.style.display = 'none';
                    adminPanel.style.display = 'block';
                    if (allPlayersList.length === 0) fetchAllPlayers();
                } else {
                    alert("접근 권한이 없는 계정입니다.\n(" + user.email + ")");
                    signOut(auth).then(() => { location.reload(); });
                }
            } else {
                loginContainer.style.display = 'block';
                adminPanel.style.display = 'none';
            }
        });

        // ==========================================
        // 0. 초기화 및 선수 매핑
        // ==========================================
        let nameToIdMap = {};
        let allPlayersList = [];

        async function fetchAllPlayers() {
            const teams = ['playerA', 'playerU18', 'playerU15'];
            nameToIdMap = {};
            allPlayersList = [];

            for (const t of teams) {
                try {
                    const snapshot = await get(ref(db, t));
                    if (snapshot.exists()) {
                        const data = snapshot.val();
                        for (const [id, info] of Object.entries(data)) {
                            if (info.name) {
                                if (!nameToIdMap[info.name]) nameToIdMap[info.name] = id;
                                allPlayersList.push({ name: info.name, id: id });
                            }
                        }
                    }
                } catch (e) { console.log("로드 에러:", t); }
            }
            console.log("매핑 완료. 총 선수:", allPlayersList.length);
        }

        const currYear = new Date().getFullYear();
        const yearOptions = [];
        for (let y = 2015; y <= currYear + 1; y++) yearOptions.push(y);
        
        const nSelect = document.getElementById('n_yearSelect');
        const sSelect = document.getElementById('s_yearSelect');
        
        yearOptions.reverse().forEach(y => {
            nSelect.add(new Option(y, y));
            sSelect.add(new Option(y, y));
        });
        nSelect.value = currYear;
        sSelect.value = currYear;


        // ==========================================
        // 1. 경기 데이터 로직
        // ==========================================
        const positions = ['GK', 'DF', 'MF', 'FW', 'SUB'];
        const matchContainer = document.getElementById('match-player-inputs');

        positions.forEach(pos => {
            const section = document.createElement('div');
            section.className = 'pos-section';
            section.id = `section-${pos}`;
            section.innerHTML = `<div class="pos-title">${pos}</div><div class="pos-rows-container"></div>`;
            matchContainer.appendChild(section);
            addMatchPlayerRow(pos); 
        });

        function addMatchPlayerRow(pos, name='', id='', stat='') {
            const container = document.querySelector(`#section-${pos} .pos-rows-container`);
            const index = container.querySelectorAll('.player-grid-row').length + 1; 
            
            const div = document.createElement('div');
            div.className = `player-grid-row ${pos}-row`;
            div.innerHTML = `
                <div class="row-index">${index}</div>
                <input type="text" placeholder="이름" class="p-name-auto" value="${name}">
                <input type="tel" placeholder="ID" class="p-id" value="${id}">
                <input type="text" placeholder="스탯" class="p-stat" value="${stat}">
            `;
            
            div.querySelectorAll('input').forEach(input => {
                input.addEventListener('input', () => checkAndAddMatchRow(pos));
            });
            container.appendChild(div);
        }

        function checkAndAddMatchRow(pos) {
            const container = document.querySelector(`#section-${pos} .pos-rows-container`);
            const lastRow = container.lastElementChild;
            if(!lastRow) return;
            const inputs = lastRow.querySelectorAll('input');
            let hasValue = false;
            inputs.forEach(i => { if(i.value.trim()) hasValue = true; });
            if(hasValue) addMatchPlayerRow(pos);
        }

        // 세부 지표 입력칸 생성
        const statLabels = ['점유율', '슈팅', '유효슈팅', '파울', '경고', '퇴장', '경고 누적', '코너킥', '프리킥', '오프사이드'];
        const statContainer = document.getElementById('match-stats-inputs');
        statLabels.forEach((label, idx) => {
            const row = document.createElement('div');
            row.className = 'stat-row';
            row.innerHTML = `
                <div class="stat-label">${label}</div>
                <input type="text" class="stat-input m-stat-home" id="m_stat_home_${idx}" placeholder="0">
                <input type="text" class="stat-input m-stat-away" id="m_stat_away_${idx}" placeholder="0">
            `;
            statContainer.appendChild(row);
        });

        document.body.addEventListener('input', function(e) {
            if (e.target.classList.contains('p-name-auto')) {
                const nameInput = e.target;
                const row = nameInput.parentElement;
                const idInput = row.querySelector('.p-id'); 
                if (!idInput) return;

                const name = nameInput.value.trim();
                
                if (name === '') {
                    idInput.value = '';
                    idInput.classList.remove('warning-input');
                    idInput.placeholder = "ID";
                    return;
                }

                if (nameToIdMap[name]) {
                    idInput.value = nameToIdMap[name];
                    idInput.classList.remove('warning-input');
                } else {
                    idInput.value = ''; 
                    idInput.classList.add('warning-input');
                    idInput.placeholder = "ID 없음";
                }
            }
        });


        // ==========================================
        // 2. [선수 정보] 중복 확인 & ID 생성
        // ==========================================
        document.getElementById('btnCheckName').addEventListener('click', () => {
            const inputName = document.getElementById('p_name').value.trim();
            if(!inputName) return alert("이름을 입력하세요.");

            const cleanInputName = inputName.replace(/[0-9]/g, '');
            const matches = allPlayersList.filter(player => {
                const cleanDbName = player.name.replace(/[0-9]/g, '');
                return cleanDbName === cleanInputName;
            });

            if (matches.length > 0) {
                const msgList = matches.map(m => `- ${m.name} (${m.id})`).join('\n');
                alert(`총 ${matches.length}명의 선수가 검색되었습니다:\n\n${msgList}`);
            } else {
                alert('중복된 선수가 없습니다.');
            }
        });

        document.getElementById('btnGenerateId').addEventListener('click', () => {
            const name = document.getElementById('p_name').value.trim();
            if (!name) return alert("이름을 먼저 입력하세요.");

            const codes = [];
            for (let i = 0; i < name.length; i++) {
                codes.push(name.charCodeAt(i));
            }

            let id = 0;
            if (name.length === 3) {
                id = Math.round((codes[0] * codes[1] + codes[2]) / 100);
            } else if (name.length === 2) {
                id = Math.round((codes[0] + codes[1]) * 1000);
            } else if (name.length === 4) {
                let part1 = Math.round((codes[0] * codes[1] + codes[2]) / 1000);
                id = part1 * 10 + codes[3];
            } else {
                return alert("2~4글자 이름만 생성 가능합니다.");
            }

            const generatedId = id.toString();
            document.getElementById('p_id').value = generatedId;

            const duplicatePlayer = allPlayersList.find(p => p.id === generatedId);
            if (duplicatePlayer) {
                alert(`ID가 생성되었습니다: ${generatedId}\n\n⚠️ 경고: 이 ID는 이미 존재합니다!\n(중복된 선수: ${duplicatePlayer.name})`);
            } else {
                alert(`ID가 생성되었습니다: ${generatedId}\n\n✅ 사용 가능한 ID입니다.`);
            }
        });


        // ==========================================
        // 3. 색상/엠블럼 미리보기
        // ==========================================
        function updateColorPreview(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            const value = input.value.replace(/[^0-9A-Fa-f]/g, '');
            input.value = value; 
            if(value.length >= 3) {
                preview.style.backgroundColor = '#' + value;
            } else {
                preview.style.backgroundColor = '#fff';
            }
        }

// 엠블럼 미리보기 함수
function updateEmblemPreview(inputId, previewId, useSearch = false) {
    const input = document.getElementById(inputId);
    const img = document.getElementById(previewId);
    const code = input.value.trim();

    if (!code) {
        img.style.display = 'none';
        img.src = '';
        return;
    }

    const exactSrc = `../files/${code}_s.png`;
    const testImg = new Image();

    testImg.onload = function() {
        img.src = exactSrc; 
        img.style.display = 'block';
    };

    testImg.onerror = function() {
        // [수정] useSearch가 true일 때만 연도별 재귀 탐색 함수 호출
        if (useSearch) {
            // 아래에 정의될 함수를 호출합니다.
            startYearSearch(code, img); 
        } else {
            img.style.display = 'none';
            img.src = '';
        }
    };
    testImg.src = exactSrc;
}

        // ----------------------------------------------------
        // [이벤트 리스너] 
        // ----------------------------------------------------

        // 1. 경기 기록 페이지 (대회 코드 및 팀 코드 - 정확히 일치할 때만 false)
        document.getElementById('m_compCode').addEventListener('input', () => updateEmblemPreview('m_compCode', 'preview_comp', false));
        document.getElementById('m_homeCode').addEventListener('input', () => updateEmblemPreview('m_homeCode', 'preview_home', false));
        document.getElementById('m_awayCode').addEventListener('input', () => updateEmblemPreview('m_awayCode', 'preview_away', false));
        
        // 2. 상대 전적 페이지 (연도 없어도 검색 - 세 번째 인자 true)
        document.getElementById('h_code').addEventListener('input', () => updateEmblemPreview('h_code', 'preview_h2h', true));

        // 색상 미리보기
        document.getElementById('h_bg').addEventListener('input', () => updateColorPreview('h_bg', 'preview_bg'));
        document.getElementById('h_text').addEventListener('input', () => updateColorPreview('h_text', 'preview_text'));

        // ==========================================
        // 4. 순위표 미리보기 & 자동 계산 (수정됨)
        // ==========================================
        function updateStandingsPreview() {
            const raw = document.getElementById('s_data').value;
            const container = document.getElementById('standings-preview');
            
            if(!raw.trim()) {
                container.innerHTML = '<div style="color:#888; font-size:13px; text-align:center;">데이터를 입력하면 미리보기가 표시됩니다.</div>';
                return;
            }

            const rows = raw.split('\n');
            let html = '<table id="preview-table"><thead><tr><th>순위</th><th>팀명</th><th>승점</th><th>승</th><th>무</th><th>패</th><th>득</th><th>실</th><th>득실</th></tr></thead><tbody>';
            
            rows.forEach((row, index) => {
                if(!row.trim()) return;
                
                // 입력: [팀명, 승, 무, 패, 득, 실] (6개)
                const cols = row.split('  ').map(c => c.trim());
                if (cols.length < 6) return; // 데이터 부족하면 스킵

                const team = cols[0];
                const w = parseInt(cols[1]) || 0;
                const d = parseInt(cols[2]) || 0;
                const l = parseInt(cols[3]) || 0;
                const gf = parseInt(cols[4]) || 0;
                const ga = parseInt(cols[5]) || 0;

                // 자동 계산
                const rank = index + 1;
                const pts = (w * 3) + (d * 1);
                const gd = gf - ga;

                // 미리보기 출력
                html += '<tr>';
                html += `<td>${rank}</td>`;
                html += `<td>${team}</td>`;
                html += `<td>${pts}</td>`;
                html += `<td>${w}</td>`;
                html += `<td>${d}</td>`;
                html += `<td>${l}</td>`;
                html += `<td>${gf}</td>`;
                html += `<td>${ga}</td>`;
                html += `<td>${gd}</td>`;
                html += '</tr>';
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        }
        document.getElementById('s_data').addEventListener('input', updateStandingsPreview);


        // ==========================================
        // 5. 기본 기능 구현 (저장/불러오기)
        // ==========================================

        window.showForm = function (id) {
            document.querySelectorAll('.form-container').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.menu-bar button').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
        }

        function getTeamType() {
            return document.querySelector('input[name="teamType"]:checked').value;
        }

        // [경기 기록]
        document.getElementById('btnSearchMatch').addEventListener('click', async () => {
            const team = getTeamType();
            const date = document.getElementById('m_date').value;
            if(!date) { alert('날짜 입력'); return; }

            let suffix = team === 'U18' ? '8' : (team === 'U15' ? '5' : '0');
            const id = date + suffix;
            
            try {
                const snapshot = await get(ref(db, `data${team}/${id}`));
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    document.getElementById('m_round').value = data.round || '';
                    document.getElementById('m_compName').value = data.comp?.[0] || '';
                    document.getElementById('m_compCode').value = data.comp?.[1] || '';
                    document.getElementById('m_stadium').value = data.stadium || '';
                    document.getElementById('m_hl').value = data.hl || '';
                    
                    if(data.time) {
                        const [h, m] = data.time.split(':');
                        document.getElementById('m_hour').value = h; document.getElementById('m_min').value = m;
                    }
                    document.getElementById('m_homeName').value = data.home?.[0] || '';
                    document.getElementById('m_homeCode').value = data.home?.[1] || '';
                    document.getElementById('m_homeScore').value = data.homeScore || '';
                    document.getElementById('m_homeScorer').value = data.homeScorer || '';

                    document.getElementById('m_awayName').value = data.away?.[0] || '';
                    document.getElementById('m_awayCode').value = data.away?.[1] || '';
                    document.getElementById('m_awayScore').value = data.awayScore || '';
                    document.getElementById('m_awayScorer').value = data.awayScorer || '';

                    // 세부 지표 불러오기
                    if(data.matchStat && data.matchStat.length === 20) {
                        for(let i=0; i<10; i++) {
                            document.getElementById(`m_stat_home_${i}`).value = data.matchStat[i*2];
                            document.getElementById(`m_stat_away_${i}`).value = data.matchStat[i*2 + 1];
                        }
                    } else {
                        document.querySelectorAll('.stat-input').forEach(input => input.value = '');
                    }

                    // 사진 미리보기 업데이트
                    updateEmblemPreview('m_compCode', 'preview_comp');
                    updateEmblemPreview('m_homeCode', 'preview_home');
                    updateEmblemPreview('m_awayCode', 'preview_away');

                    positions.forEach(pos => {
                        const rowContainer = document.querySelector(`#section-${pos} .pos-rows-container`);
                        rowContainer.innerHTML = ''; 
                        
                        if(data[pos] && data[pos].length > 0) {
                            data[pos].forEach(p => {
                                const pid = p[0];
                                const stat = p[1];
                                const name = Object.keys(nameToIdMap).find(key => nameToIdMap[key] === pid) || '';
                                addMatchPlayerRow(pos, name, pid, stat);
                            });
                        }
                        addMatchPlayerRow(pos);
                    });

                    alert('로드 완료');
                } else { alert('데이터 없음'); }
            } catch(e) { console.error(e); alert('실패'); }
        });

        document.getElementById('btnSaveMatch').addEventListener('click', async () => {
            const team = getTeamType();
            const date = document.getElementById('m_date').value;
            if (!date) { alert('날짜 입력'); return; }
            let suffix = team === 'U18' ? '8' : (team === 'U15' ? '5' : '0');
            const id = date + suffix;
            const timeStr = (document.getElementById('m_hour').value && document.getElementById('m_min').value) 
                            ? `${document.getElementById('m_hour').value}:${document.getElementById('m_min').value}` : "";

            const getPlayers = (pos) => {
                const rows = document.querySelectorAll(`#section-${pos} .player-grid-row`);
                let result = [];
                rows.forEach(row => {
                    const pid = row.querySelector('.p-id').value.trim();
                    const stat = row.querySelector('.p-stat').value.trim();
                    if(pid) result.push([pid, stat]); 
                });
                return result;
            };

            const matchStatsArr = [];
            for(let i=0; i<10; i++) {
                matchStatsArr.push(document.getElementById(`m_stat_home_${i}`).value || "");
                matchStatsArr.push(document.getElementById(`m_stat_away_${i}`).value || "");
            }

            const matchData = {
                "round": document.getElementById('m_round').value,
                "comp": [document.getElementById('m_compName').value, document.getElementById('m_compCode').value],
                "time": timeStr,
                "stadium": document.getElementById('m_stadium').value,
                "home": [document.getElementById('m_homeName').value, document.getElementById('m_homeCode').value],
                "away": [document.getElementById('m_awayName').value, document.getElementById('m_awayCode').value],
                "homeScore": document.getElementById('m_homeScore').value,
                "awayScore": document.getElementById('m_awayScore').value,
                "homeScorer": document.getElementById('m_homeScorer').value,
                "awayScorer": document.getElementById('m_awayScorer').value,
                "hl": document.getElementById('m_hl').value,
                "matchStat": matchStatsArr,
                "GK": getPlayers('GK'), "DF": getPlayers('DF'), "MF": getPlayers('MF'), "FW": getPlayers('FW'), "SUB": getPlayers('SUB')
            };

            try { await set(ref(db, `data${team}/${id}`), matchData); alert(`저장 완료: ${id}`); } 
            catch (e) { console.error(e); alert("실패"); }
        });

        // [경기 삭제 기능]
        document.getElementById('btnDeleteMatch').addEventListener('click', async () => {
            const team = getTeamType();
            const date = document.getElementById('m_date').value;
            
            if(!date) return alert('삭제할 날짜를 입력하세요.');
            
            let suffix = team === 'U18' ? '8' : (team === 'U15' ? '5' : '0');
            const id = date + suffix;

            if(confirm(`정말로 삭제하시겠습니까?\n\n팀: ${team}\n날짜: ${date}\nID: ${id}`)) {
                try {
                    await remove(ref(db, `data${team}/${id}`));
                    alert('삭제 완료되었습니다.');
                    document.getElementById('m_date').value = '';
                } catch(e) {
                    console.error(e);
                    alert('삭제 실패: ' + e.message);
                }
            }
        });

        // [선수 정보]
        document.getElementById('btnSearchPlayer').addEventListener('click', async () => {
            const team = getTeamType();
            const id = document.getElementById('p_id').value;
            if(!id) { alert('ID 입력'); return; }
            try {
                const s = await get(ref(db, `player${team}/${id}`));
                if(s.exists()) {
                    const d = s.val();
                    document.getElementById('p_name').value = d.name||''; document.getElementById('p_bd').value = d.bd||'';
                    document.getElementById('p_natl').value = d.natl||''; document.getElementById('p_pos').value = d.pos||'';
                    document.getElementById('p_height').value = d.height||''; document.getElementById('p_sns').value = d.sns||'';
                    document.getElementById('p_sefc').value = d.sefc||'';
                    alert('로드 완료');
                } else alert('데이터 없음');
            } catch(e) { console.error(e); }
        });

        document.getElementById('btnSavePlayer').addEventListener('click', async () => {
            const team = getTeamType();
            const id = document.getElementById('p_id').value;
            if(!id) return alert('ID 필수');
            const data = {
                name: document.getElementById('p_name').value, bd: document.getElementById('p_bd').value,
                natl: document.getElementById('p_natl').value, pos: document.getElementById('p_pos').value,
                height: document.getElementById('p_height').value, sns: document.getElementById('p_sns').value,
                sefc: document.getElementById('p_sefc').value
            };
            try {
                await update(ref(db, `player${team}/${id}`), data);
                if(data.name) nameToIdMap[data.name] = id;
                const existingIdx = allPlayersList.findIndex(p => p.id === id);
                if(existingIdx > -1) allPlayersList[existingIdx].name = data.name;
                else allPlayersList.push({name: data.name, id: id});
                
                alert('저장 완료');
            } catch(e) { console.error(e); }
        });

        // [선수 삭제 기능]
        document.getElementById('btnDeletePlayer').addEventListener('click', async () => {
            const team = getTeamType();
            const id = document.getElementById('p_id').value;
            if(!id) return alert('삭제할 선수 ID를 입력하세요.');
            
            if(confirm(`정말로 삭제하시겠습니까?\n\n팀: ${team}\nID: ${id}`)) {
                try {
                    await remove(ref(db, `player${team}/${id}`));
                    const idx = allPlayersList.findIndex(p => p.id === id);
                    if(idx > -1) allPlayersList.splice(idx, 1);
                    if(nameToIdMap[document.getElementById('p_name').value]) {
                        delete nameToIdMap[document.getElementById('p_name').value];
                    }
                    alert('삭제 완료되었습니다.');
                    document.getElementById('p_id').value = '';
                    document.getElementById('p_name').value = '';
                } catch(e) {
                    console.error(e);
                    alert('삭제 실패: ' + e.message);
                }
            }
        });

        // [상대 전적]
        document.getElementById('btnSearchH2H').addEventListener('click', async () => {
            const team = getTeamType();
            const code = document.getElementById('h_code').value;
            if(!code) return;
            try {
                const s = await get(ref(db, `h2h${team}/${code}`));
                if(s.exists() && Array.isArray(s.val())) {
                    const a = s.val();
                    updateEmblemPreview('h_code', 'preview_h2h');
                    document.getElementById('h_bg').value=a[0]; document.getElementById('h_text').value=a[1];
                    updateColorPreview('h_bg', 'preview_bg'); updateColorPreview('h_text', 'preview_text');
                    document.getElementById('h_w').value=a[2]; document.getElementById('h_d').value=a[3];
                    document.getElementById('h_l').value=a[4]; document.getElementById('h_gf').value=a[5];
                    document.getElementById('h_ga').value=a[6];
                    alert('로드 완료');
                } else alert('데이터 없음');
            } catch(e) { console.error(e); }
        });

        document.getElementById('btnSaveH2H').addEventListener('click', async () => {
            const team = getTeamType();
            const code = document.getElementById('h_code').value;
            if(!code) return alert('코드 입력');
            const arr = [
                document.getElementById('h_bg').value, document.getElementById('h_text').value,
                document.getElementById('h_w').value, document.getElementById('h_d').value,
                document.getElementById('h_l').value, document.getElementById('h_gf').value,
                document.getElementById('h_ga').value
            ];
            try { await set(ref(db, `h2h${team}/${code}`), arr); alert('저장 완료'); } catch(e){console.error(e);}
        });

        // [등번호]
        const numContainer = document.getElementById('num-list-container');
        function addNumRow(name='', id='', num='') {
            const div = document.createElement('div');
            div.className = 'player-grid-row num-item';
            div.innerHTML = `
                <input type="text" placeholder="이름" class="p-name-auto" value="${name}">
                <input type="tel" placeholder="ID" class="p-id" value="${id}">
                <input type="tel" placeholder="번호" class="p-num" value="${num}">
            `;
            div.querySelector('.p-num').addEventListener('input', checkAndAddRow);
            div.querySelector('.p-name-auto').addEventListener('input', checkAndAddRow);
            numContainer.appendChild(div);
        }
        function checkAndAddRow() {
            const last = numContainer.lastElementChild;
            if(!last) return;
            const inputs = last.querySelectorAll('input');
            let has = false; inputs.forEach(i=>{if(i.value.trim())has=true});
            if(has) addNumRow();
        }

        document.getElementById('n_yearSelect').addEventListener('change', async function() {
            const year = this.value;
            numContainer.innerHTML = '';
            try {
                const s = await get(ref(db, `playerNum/${year}`));
                if(s.exists()) {
                    for(const [pid, info] of Object.entries(s.val())) addNumRow(info[0], pid, info[1]);
                }
                addNumRow();
            } catch(e) { console.error(e); }
        });
        (async()=>{ document.getElementById('n_yearSelect').dispatchEvent(new Event('change')); })();

        document.getElementById('btnSaveNum').addEventListener('click', async () => {
            const year = document.getElementById('n_yearSelect').value;
            const rows = document.querySelectorAll('.num-item');
            let data = {}, count = 0;
            rows.forEach(r => {
                const nm=r.querySelector('.p-name-auto').value, id=r.querySelector('.p-id').value, n=r.querySelector('.p-num').value;
                if(id) { data[id]=[nm,n]; count++; }
            });
            if(count===0 && !confirm('비우시겠습니까?')) return;
            try { await set(ref(db, `playerNum/${year}`), data); alert('저장 완료'); } catch(e){console.error(e);}
        });

        // [순위 - 불러오기 및 저장 로직 수정]
        async function loadStandings() {
            const year = document.getElementById('s_yearSelect').value;
            const league = document.getElementById('s_leagueType').value;
            const ta = document.getElementById('s_data');
            ta.value = '로드 중...';
            try {
                const s = await get(ref(db, `standings/${year}/${league}`));
                if(s.exists() && Array.isArray(s.val())) {
                    ta.value = s.val().map(row => {
                        return `${row[1]}  ${row[3]}  ${row[4]}  ${row[5]}  ${row[6]}  ${row[7]}`;
                    }).join('\n');
                } else ta.value = '';
                updateStandingsPreview();
            } catch(e) { ta.value='에러'; console.error(e); }
        }
        document.getElementById('s_yearSelect').addEventListener('change', loadStandings);
        document.getElementById('s_leagueType').addEventListener('change', loadStandings);

        document.getElementById('btnSaveStanding').addEventListener('click', async () => {
            const year = document.getElementById('s_yearSelect').value;
            const league = document.getElementById('s_leagueType').value;
            const raw = document.getElementById('s_data').value.trim();
            if(!raw && !confirm('삭제하시겠습니까?')) return;
            
            const data = [];
            raw.split('\n').forEach((l, index) => {
                if(l.trim()) {
                    const cols = l.split('  ').map(c => c.trim());
                    if (cols.length >= 6) {
                        const team = cols[0];
                        const w = parseInt(cols[1]) || 0;
                        const d = parseInt(cols[2]) || 0;
                        const l = parseInt(cols[3]) || 0;
                        const gf = parseInt(cols[4]) || 0;
                        const ga = parseInt(cols[5]) || 0;
                        const rank = index + 1;
                        const pts = (w * 3) + (d * 1);
                        const gd = gf - ga;
                        data.push([rank, team, pts, w, d, l, gf, ga, gd]);
                    }
                }
            });

            try { await set(ref(db, `standings/${year}/${league}`), data); alert('저장 완료'); } catch(e){console.error(e);}
        });

        loadStandings();

        // 상대 전적용 연도별 자동 탐색 함수
function startYearSearch(code, targetImgElement, yearToCheck = new Date().getFullYear()) {
    // 1983년(K리그 출범) 밑으로 내려가면 탐색 중단
    if (yearToCheck < 1983) {
        targetImgElement.style.display = 'none'; 
        return;
    }

    const yearSrc = `../files/${code}${yearToCheck}_s.png`;
    const searchImg = new Image();

    searchImg.onload = function() {
        targetImgElement.src = yearSrc; 
        targetImgElement.style.display = 'block';
    };

    searchImg.onerror = function() {
        // 실패 시 1년 전으로 거슬러 올라가며 재귀 호출
        startYearSearch(code, targetImgElement, yearToCheck - 1);
    };

    searchImg.src = yearSrc;
}

    </script>
</body>
</html>